# Автоматизированный сбор данных с Mouser.com

## Описание
Скрипт `undetected_sel.py` автоматизирует сбор информации о электронных компонентах с сайта mouser.com с использованием undetected-chromedriver для обхода детектирования автоматизации.

## Возможности
- ✅ Обход детектирования Selenium на Mouser.com
- ✅ Автоматическая обработка списка артикулов
- ✅ Извлечение breadcrumb (навигационной цепочки)
- ✅ Извлечение технических спецификаций
- ✅ Сохранение страниц в PDF формат
- ✅ Проверка существующих PDF (пропуск повторного сохранения)
- ✅ Сохранение результатов в Excel
- ✅ Случайные задержки для имитации поведения человека
- ✅ Тестовый режим (2 артикула) и полная обработка
- ✅ Поддержка headless режима
- ✅ Обработка ошибок для каждого артикула

## Настройки запуска (в начале `if __name__ == "__main__"`)

```python
TEST_MODE = True   # True - тест (2 артикула), False - все артикулы
HEADLESS = False   # True - headless, False - видимый браузер
SKIP_INIT = False  # True - пропустить инициализацию cookies/языка
```

## Пути

```python
DATASHEET_DIR = r'c:\users\gorah\downloads\mouser_datasheets'  # Папка для PDF
EXCEL_FILE = r'c:\users\gorah\downloads\mouser_datasheets\mouser_data.xlsx'  # Excel файл
```

## Структура Excel файла

| Колонка | Описание |
|---------|----------|
| Артикул | Исходный артикул из списка |
| Part Number | Официальный номер детали от производителя |
| Заголовок | Навигационная цепочка (breadcrumb) |
| PDF сохранен | Да/Нет - флаг сохранения PDF |
| PDF файл | Имя сохраненного PDF файла |
| Спец: * | Технические характеристики (динамические колонки) |
| Ошибка | Описание ошибки (если возникла) |

## Запуск

```bash
cd D:\dev\mouser_parser
python undetected_sel.py
```

## Список артикулов

Редактируйте константу `ARTICLE_LIST` в начале файла:

```python
ARTICLE_LIST = [
    'APHCM2012SYCK-F01',
    'APHCM2012ZGC-F01',
    # ... добавьте свои артикулы
]
```

## Ключевые улучшения по сравнению с исходной версией

### 1. Минимальная конфигурация undetected_chromedriver
Убраны избыточные антидетект-меры, которые создавали конфликты:
- Удален `selenium_stealth` (конфликтовал с uc)
- Убраны ручные CDP команды для маскировки
- Оставлены только базовые опции Chrome

### 2. Имитация человеческого поведения
- `human_delay()` - случайные задержки между действиями (0.5-2 сек)
- Случайные паузы между артикулами (2-5 сек)
- Увеличенные таймауты ожидания элементов (15-20 сек)

### 3. Надежная обработка элементов
- `ElementHelper` с retry механизмом для StaleElementException
- Fallback логика для пропуска необязательных элементов (cookies, язык)
- Try-except блоки для каждого артикула

### 4. Оптимизация работы
- Проверка существования PDF перед сохранением
- Инициализация сессии один раз в начале
- Сохранение результатов в Excel + JSON (резервная копия)

## Результат тестирования

✅ **Mouser.com НЕ детектирует** undetected-chromedriver
✅ Доступ к сайту получен успешно
✅ Извлечение данных работает корректно

## Примечания

1. **Первый запуск**: Может потребоваться ручное принятие cookies и выбор языка в браузере
2. **SKIP_INIT=True**: Используйте после первого успешного запуска для ускорения
3. **Headless режим**: Может работать хуже из-за дополнительного детектирования
4. **Задержки**: Не уменьшайте задержки слишком сильно - это может привести к блокировке

## Дополнительные файлы

- `term_cmds.py` - Рабочий ручной сценарий (база для автоматизации)
- `test_simple.py` - Простой тест доступа к Mouser.com
- `results.json` - Резервная копия результатов в JSON формате
